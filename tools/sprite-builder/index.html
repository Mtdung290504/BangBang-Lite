<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sprite Sheet Rotator (Grid)</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #333;
            color: white;
        }

        canvas {
            margin: 10px 0;
            display: block;
            background-color: #333;
        }
    </style>
</head>

<body>

    <h2>üîÑ T·∫°o sprite sheet xoay 360¬∞ t·ª´ ·∫£nh ngu·ªìn (grid 2400px)</h2>
    <input type="file" id="upload" accept="image/*">
    <br>
    <canvas id="preview" width="128" height="128"></canvas>
    <br>
    <button id="generate">T·∫°o sprite sheet</button>
    <br>
    <canvas id="sheet"></canvas>
    <pre id="manifest"></pre>

    <script>
        const upload = document.getElementById('upload');
        const previewCanvas = document.getElementById('preview');
        const previewCtx = previewCanvas.getContext('2d');

        const sheetCanvas = document.getElementById('sheet');
        const sheetCtx = sheetCanvas.getContext('2d');

        const manifestEl = document.getElementById('manifest');

        let sourceImage = null;

        upload.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            const img = new Image();
            img.onload = () => {
                sourceImage = img;
                previewCanvas.width = img.width;
                previewCanvas.height = img.height;
                previewCtx.clearRect(0, 0, img.width, img.height);
                previewCtx.drawImage(img, 0, 0);
            };
            img.src = URL.createObjectURL(file);
        });

        document.getElementById('generate').addEventListener('click', () => {
            if (!sourceImage) {
                alert("H√£y ch·ªçn m·ªôt ·∫£nh tr∆∞·ªõc.");
                return;
            }

            const frameCount = 60;
            const frameW = sourceImage.width;
            const frameH = sourceImage.height;
            const maxSheetWidth = 2400;

            // T√≠nh s·ªë c·ªôt t·ªëi ƒëa d·ª±a v√†o max width
            const cols = Math.floor(maxSheetWidth / frameW);
            const rows = Math.ceil(frameCount / cols);

            sheetCanvas.width = cols * frameW;
            sheetCanvas.height = rows * frameH;

            const manifest = {};

            // T√≠nh padding
            const padX = frameW * 0.15;
            const padY = frameH * 0.15;
            const paddedW = frameW + padX * 2;
            const paddedH = frameH + padY * 2;

            // T√≠nh cols/rows nh∆∞ c≈©
            sheetCanvas.width = paddedW * cols;
            sheetCanvas.height = paddedH * rows;

            // Trong v√≤ng l·∫∑p frame:
            for (let i = 0; i < frameCount; i++) {
                const angle = (i * 2 * Math.PI) / frameCount;

                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = paddedW;
                tempCanvas.height = paddedH;
                const tempCtx = tempCanvas.getContext('2d');

                tempCtx.translate(paddedW / 2, paddedH / 2); // d·ªãch v·ªÅ t√¢m canvas
                tempCtx.rotate(angle);
                tempCtx.drawImage(sourceImage, -frameW / 2, -frameH / 2); // v·∫Ω v√†o t√¢m

                const col = i % cols;
                const row = Math.floor(i / cols);
                const dx = col * paddedW;
                const dy = row * paddedH;

                sheetCtx.drawImage(tempCanvas, dx, dy);

                manifest[`frame_${i}`] = {
                    x: dx,
                    y: dy,
                    width: paddedW,
                    height: paddedH
                };
            }

            manifestEl.textContent = JSON.stringify(manifest, null, 2);
        });
    </script>

</body>

</html>